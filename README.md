# P2P Port Mapper

一个简单的 Rust 应用程序，用于在配置的端口对之间建立点对点 (P2P) 的 TCP 流量转发。

**免责声明：** 此项目的核心代码主要由 AI 编程助手生成。

## 功能

*   **端口转发**: 监听配置的端口对（例如，A 和 B）。当两个端口都有一个连接时，将从 A 收到的数据转发到 B，并将从 B 收到的数据转发到 A。
*   **配置文件驱动**: 通过 `config/default.toml` 文件配置要监听和转发的端口对。
*   **多端口对支持**: 可以同时处理配置文件中定义的多个独立的端口对。
*   **单连接限制**: 对于每个端口（A 或 B），只允许同时存在一个活动的连接（等待配对或正在转发）。后续尝试连接到已被占用的端口的请求将被拒绝。

## 先决条件

*   Rust 工具链 (包括 `cargo`)。访问 [https://www.rust-lang.org/tools/install](https://www.rust-lang.org/tools/install) 获取安装说明。

## 配置

1.  在项目根目录下创建一个名为 `config` 的文件夹。
2.  在 `config` 文件夹内创建一个名为 `default.toml` 的文件。
3.  编辑 `config/default.toml` 文件，定义 `port_pairs` 数组。每个元素必须是一个包含两个 `u16` 端口号的数组。

    **示例 `config/default.toml`:**

    ```toml
    # 定义要进行端口转发的端口对列表
    # 每个内部数组必须包含两个 u16 类型的端口号
    port_pairs = [
        [8080, 8081], # 将端口 8080 的流量转发到 8081，反之亦然
        [9000, 9001], # 另一对端口
        # 可以根据需要添加更多端口对
    ]
    ```

    **重要:** 如果 `port_pairs` 中的任何子数组不包含恰好两个端口号，程序将在启动时因配置错误而失败。

## 运行项目

在项目根目录下，运行以下命令来编译和启动应用程序：

```bash
cargo run
```

应用程序将读取 `config/default.toml` 文件，并为其中配置的每一对端口启动监听器。日志信息将输出到控制台，显示监听状态、连接尝试、配对成功和数据转发的详细信息。 